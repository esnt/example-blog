---
layout: post
title:  "Breathe Easy: Using the EPA's Air Quality System API"
author: E. Shannon Neeley Tass
description: This is a cool project
image: /assets/images/balloons.jpg
---

# Introduction

Air pollution is a [known contributor](https://ourworldindata.org/air-pollution) to deaths and breathing related health problems.  Poor air quality is especially hazardous for individuals with lung diseases, such as asthma, COPD and [bronchiectasis](https://www.lung.org/lung-health-diseases/lung-disease-lookup/bronchiectasis), a disease with which my husband Frank has been diagnosed.  With Frank's lung condition, even days with moderate air quality are uncomfortable and dangerous.     

Frank and I have lived in Utah for several years.  While this part of the country is very beautiful and friendly, there are times when the Salt Lake City area ranks among the [worst metropolitan areas](https://snowbrains.com/why-salt-lake-city-ut-has-some-of-the-worlds-worst-air-quality-in-the-world-and-what-we-can-do-to-fix-it1/) in the world in terms of air quality.  

 <a title="Eltiempo10, CC BY-SA 4.0 &lt;https://creativecommons.org/licenses/by-sa/4.0&gt;, via Wikimedia Commons" href="https://commons.wikimedia.org/wiki/File:Salt_Lake_City_smog_haze_skyline_01.jpg"><em>Smog and haze over Salt Lake City skyline.</em><img width="650" alt="Salt Lake City smog haze skyline 01" src="https://upload.wikimedia.org/wikipedia/commons/thumb/a/a8/Salt_Lake_City_smog_haze_skyline_01.jpg/512px-Salt_Lake_City_smog_haze_skyline_01.jpg"></a>

### Finding Other Air

Since we have a lot of family and friends in Arizona, I have been wondering how the air quality in the Salt Lake City & Provo metropolitan areas in Utah compares to that of the Phoenix metropolitan area in Arizona.  [Phoenix](https://en.wikipedia.org/wiki/Phoenix,_Arizona) is the fifth largest city and 11th largest metropolitan area in the United States.  It is also known for being in an area with [wild fires](https://www.fireweatheravalanche.org/wildfires/dashboard/local/arizona/phoenix#:~:text=There%20are%20no%20wildfires%20in%20this%20area%20right%20now.) and [dust storms](https://ein.az.gov/hazards/dust-storms); consequently, it is reasonable to assume that Phoenix will also have days with very poor air quality.  

<a title="Zooey, CC BY-SA 2.0 &lt;https://creativecommons.org/licenses/by-sa/2.0&gt;, via Wikimedia Commons" href="https://commons.wikimedia.org/wiki/File:Dust_storm_clouds_gathering.jpg"><em>Dust storm clouds rolling into Phoenix.</em><img width="650" alt="Dust storm clouds gathering" src="https://upload.wikimedia.org/wikipedia/commons/thumb/3/33/Dust_storm_clouds_gathering.jpg/512px-Dust_storm_clouds_gathering.jpg"></a>

### Let the data decide

For this project I will use outdoor air quality data available from the [United States Environmental Protection Agency](https://www.epa.gov/outdoor-air-quality-data). In this blog post, I will explain how I used the [Air Quality System (AQS) API](https://aqs.epa.gov/aqsweb/documents/data_api.html) to get air quality data for my locations of interest.  A [later blog post]() will compare the Phoenix and Salt Lake/Provo air quality data to see if there is a clear winner (just between these two regions) in terms of "good air".  

*Complete code and data can be found in [this GitHub repo]().*

# Data Collection

## Tools

I used Python and the Requests package to perform `get` requests directly to the API.  However, the API [documentation](https://aqs.epa.gov/aqsweb/documents/data_api.html#tips) mentions that there is an R package available on [CRAN](https://cran.r-project.org/web/packages/RAQSAPI/index.html) if you prefer working with an API interface and/or prefer working in R.    

![alt text](/assets/images/Picture1.png)


## Step 1: Obtaining the API key

Registering for an API key is done with a call to the [signup](https://aqs.epa.gov/aqsweb/documents/data_api.html#signup) endpoint of the API:

1. Paste the following url directly in a web browser (or use `requests.get` in python):
```
https://aqs.epa.gov/data/api/signup?email=myemail@example.com
``` 
except that you need to replace the text `myemail@example.com` with a valid email address\*. 
<p align="right"><sup><em>(*All example code and output with the text <code>myemail@example.com</code> should be replaced with this email address)</em></sup></p>

2. You should get a json response that looks similar to this:
```
{
  "Header": [
    {
      "status": "Success",
      "request_time": "2022-10-04T14:07:53-04:00",
      "url": "https://aqs.epa.gov/data/api/signup?email=myemail@example.com"
    }
  ],
  "Data": [
    "You should receive a registration confirmation email with a link for confirming your email shortly."
  ]
}
```
3.  Check your email for a message with the subject "AQS API Registration Confirmation - myemail@example.com" from "aqsdatamart@epa.gov"
- If you don't see the email, check your spam folder -- that's where I found mine!

4.  The email will contain your API key, but you need to confirm your account by clicking on the link in the email before your key will work.  


## Pre-generated data versus the API
On the [EPA air quality website](https://www.epa.gov/outdoor-air-quality-data), there are various ways shown to download data.  Noteably, there are several [pre-generated data files](https://aqs.epa.gov/aqsweb/airdata/download_files.html) that are available for download  without using the API.  I chose to use the [API](https://aqs.epa.gov/aqsweb/documents/data_api.html) instead of the pre-generated data files because automated data collection of the locations, times, and variables that I am interested in seemed easier than downloading various data files that likely contain too much or too little data relevant to my question of interest.  However, it might be worth taking a look at the readily available file to see if there is already data compiled that suits your needs.  








